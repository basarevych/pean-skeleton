/* pean-skeleton - v0.0.0 - 2016-03-01 */

"use strict";var app=angular.module("app",["ngResource","ngCookies","ngAnimate","angular-loading-bar","globalizeWrapper","ui.router","ui.bootstrap","ui.tree","dynamicTable","hljs","api","services","directives","filters","forms","state.layout","state.index","state.profile","state.role-list","state.permission-list","state.user-list","state.token-list","state.job-list","state.send-notification"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("layout",{"abstract":!0,controller:"LayoutCtrl",templateUrl:"views/layout.html"}).state("layout.index",{url:"/",title:"APP_TITLE",controller:"IndexCtrl",templateUrl:"views/index.html"}).state("layout.profile",{url:"/profile",title:"APP_TITLE",controller:"ProfileCtrl",templateUrl:"views/profile.html"}).state("layout.role-list",{url:"/role",title:"APP_TITLE",controller:"RoleListCtrl",templateUrl:"views/role-list.html",roles:["admin"]}).state("layout.permission-list",{url:"/permission",title:"APP_TITLE",controller:"PermissionListCtrl",templateUrl:"views/permission-list.html",roles:["admin"]}).state("layout.user-list",{url:"/user",title:"APP_TITLE",controller:"UserListCtrl",templateUrl:"views/user-list.html",roles:["admin"]}).state("layout.token-list",{url:"/user/:userId/token",title:"APP_TITLE",controller:"TokenListCtrl",templateUrl:"views/token-list.html",roles:["admin"]}).state("layout.job-list",{url:"/job",title:"APP_TITLE",controller:"JobListCtrl",templateUrl:"views/job-list.html",roles:["admin"]}).state("layout.send-notification",{url:"/notify",title:"APP_TITLE",controller:"SendNotificationCtrl",templateUrl:"views/send-notification.html",roles:["admin"]}),b.otherwise("/")}]),app.config(["globalizeWrapperProvider",function(a){a.setCldrBasePath("cldr"),a.setL10nBasePath("l10n")}]),app.config(["dynamicTableProvider",function(a){a.setTranslationFilter("glMessage")}]),app.config(["hljsServiceProvider",function(a){a.setOptions({tabReplace:"    "})}]),app.run(["$rootScope","$window","$state","$stateParams","$filter","$timeout","AppControl","SocketServer",function(a,b,c,d,e,f,g,h){PNotify.prototype.options.styling="bootstrap3",a.appControl=g,a.socketServer=h,a.$state=c,a.$stateParams=d,a.pageTitle="Loading...",a.initialized=!1,a.$on("$stateChangeSuccess",function(b,c){a.pageTitle=e("glMessage")(c.title)}),a.$on("AppInitialized",function(){f(function(){a.initialized=!0},101)}),g.init()}]);var api=angular.module("api",["ngResource"]);api.factory("ResourceWrapper",["$rootScope","$q","$window","InfoDialog",function(a,b,c,d){return function(e,f){var g=b.defer();return e.then(function(a){g.resolve(a)})["catch"](function(b){return g.reject({error:"http",code:b.status}),f!==!0?401==b.status?(a.appControl.hasToken()&&a.appControl.removeToken(),void c.location.reload()):403==b.status?void d({title:"ERROR_API_DENIED_TITLE",text:"ERROR_API_DENIED_TEXT"}):void d({title:"ERROR_API_GENERIC_TITLE",text:"ERROR_API_GENERIC_TEXT"}):void 0}),g.promise}}]),api.factory("AuthApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/auth/:action",{},{token:{method:"POST",params:{action:"token"},isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1}});return{token:function(a,b){return c(d.token(a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)}}}]),api.factory("ProfileApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/profile/:action",{},{read:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1}});return{read:function(a,b){return c(d.read(a).$promise,b)},update:function(a,b){return c(d.update(a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)}}}]),api.factory("RoleApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/role/:id/:action",{},{list:{method:"GET",isArray:!0},create:{method:"POST",isArray:!1},read:{method:"GET",params:{id:"@id"},isArray:!1},update:{method:"PUT",params:{id:"@id"},isArray:!1},"delete":{method:"DELETE",params:{id:"@id"},isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1}});return{list:function(a,b){return c(d.list(a).$promise,b)},create:function(a,b){return c(d.create(a).$promise,b)},read:function(a,b){return c(d.read(a).$promise,b)},update:function(a,b){return c(d.update(a).$promise,b)},"delete":function(a,b){return c(d["delete"](a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)}}}]),api.factory("PermissionApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/permission/:id/:action",{},{list:{method:"GET",isArray:!0},create:{method:"POST",isArray:!1},read:{method:"GET",params:{id:"@id"},isArray:!1},update:{method:"PUT",params:{id:"@id"},isArray:!1},"delete":{method:"DELETE",params:{id:"@id"},isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1}});return{list:function(a,b){return c(d.list(a).$promise,b)},create:function(a,b){return c(d.create(a).$promise,b)},read:function(a,b){return c(d.read(a).$promise,b)},update:function(a,b){return c(d.update(a).$promise,b)},"delete":function(a,b){return c(d["delete"](a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)}}}]),api.factory("UserApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/user/:id/:action",{},{list:{method:"GET",isArray:!0},create:{method:"POST",isArray:!1},read:{method:"GET",params:{id:"@id"},isArray:!1},update:{method:"PUT",params:{id:"@id"},isArray:!1},"delete":{method:"DELETE",params:{id:"@id"},isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1},search:{method:"POST",params:{action:"search"},isArray:!0}});return{list:function(a,b){return c(d.list(a).$promise,b)},create:function(a,b){return c(d.create(a).$promise,b)},read:function(a,b){return c(d.read(a).$promise,b)},update:function(a,b){return c(d.update(a).$promise,b)},"delete":function(a,b){return c(d["delete"](a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)},search:function(a,b){return c(d.search(a).$promise,b)}}}]),api.factory("TokenApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/token/:id",{},{list:{method:"GET",isArray:!0},read:{method:"GET",params:{id:"@id"},isArray:!1},"delete":{method:"DELETE",params:{id:"@id"},isArray:!1}});return{list:function(a,b){return c(d.list(a).$promise,b)},read:function(a,b){return c(d.read(a).$promise,b)},"delete":function(a,b){return c(d["delete"](a).$promise,b)}}}]),api.factory("JobApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/job/:id/:action",{},{list:{method:"GET",isArray:!0},create:{method:"POST",isArray:!1},read:{method:"GET",params:{id:"@id"},isArray:!1},update:{method:"PUT",params:{id:"@id"},isArray:!1},"delete":{method:"DELETE",params:{id:"@id"},isArray:!1},validate:{method:"POST",params:{action:"validate"},isArray:!1},statuses:{method:"GET",params:{action:"statuses"},isArray:!0}});return{list:function(a,b){return c(d.list(a).$promise,b)},create:function(a,b){return c(d.create(a).$promise,b)},read:function(a,b){return c(d.read(a).$promise,b)},update:function(a,b){return c(d.update(a).$promise,b)},"delete":function(a,b){return c(d["delete"](a).$promise,b)},validate:function(a,b){return c(d.validate(a).$promise,b)},statuses:function(a,b){return c(d.statuses(a).$promise,b)}}}]),api.factory("NotificationApi",["$resource","$window","ResourceWrapper",function(a,b,c){var d=a(b.config.apiUrl+"/notification",{},{create:{method:"POST",isArray:!1}});return{create:function(a,b){return c(d.create(a).$promise,b)}}}]);var directives=angular.module("directives",[]);directives.directive("aclSref",["AppControl",function(a){return{link:function(b,c,d){var e=d.aclSref.split(" "),f=function(){var b=!1;angular.forEach(e,function(c){a.isAllowed(c)&&(b=!0)}),b?c.show():c.hide()};f()}}}]),directives.directive("onKeyEnter",[function(){return{restrict:"A",link:function(a,b,c,d){b.bind("keypress",function(b){13===b.keyCode&&(b.preventDefault(),a.$apply(function(){a.$eval(c.onKeyEnter)}))})}}}]),directives.directive("focusOn",["$parse","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a(e.focusOn);c.$watch(f,function(a){a===!0&&b(function(){d.focus().select(),"function"==typeof f.assign&&c.$apply(f.assign(c,!1))})})}}}]),directives.directive("sidebar",[function(){return{link:function(a,b,c){var d=$(window),e=c.sidebar,f=["xs","sm","md","lg"],g=function(){b.css({position:"fixed"});var a=b.position().top+b.outerHeight(!0),c=d.height()<a?"static":void 0;if(angular.isUndefined(c)){for(var g,h=f.length-1;h>=0;h--){var i=$("<div></div>");i.addClass("hidden-"+f[h]).appendTo($("body"));var j=i.is(":visible");if(i.remove(),!j){g=f[h];break}}angular.isDefined(g)&&(c=f.indexOf(e)>f.indexOf(g)?"static":"fixed")}angular.isDefined(c)&&b.css({position:c}),b.css({width:b.parent().width()})};d.bind("resize",g),g()}}}]),directives.directive("datetimePicker",["$filter","$rootScope",function(a,b){return{restrict:"A",require:"ngModel",link:function(c,d,e,f){d.parent().datetimepicker({format:a("glMessage")("DT_DATE_TIME_FORMAT"),locale:b.appControl.getProfile().locale.current,allowInputToggle:!0,timeZone:null,keyBinds:{enter:function(){c.$apply(function(){c.$eval(e.onKeyEnter)})}}}),d.parent().on("dp.change",function(a){c.$apply(function(){f.$setViewValue(d.val())})}),d.parent().on("dp.error",function(a){c.$apply(function(){f.$setViewValue("")})})}}}]);var filters=angular.module("filters",[]),forms=angular.module("forms",[]);forms.factory("InfoDialog",["$uibModal","globalizeWrapper",function(a,b){var c=!1,d=["$scope","$uibModalInstance","title","text","yes","variables",function(a,c,d,e,f,g){a.title=d,a.text=e,a.yes=f,a.variables=g,a.globalizeReady=null!=b.getLocale()}];return function(b){if(c)return null;c=!0;var e=a.open({controller:d,templateUrl:"modals/info-dialog.html",resolve:{title:function(){return b.title},text:function(){return angular.isArray(b.text)?b.text:[b.text]},yes:function(){return angular.isDefined(b.yes)?b.yes:""},variables:function(){return angular.isDefined(b.variables)?b.variables:{}}}});return e.result["finally"](function(){c=!1}),e}}]),forms.factory("FormHelper",["$timeout","$filter",function(a,b){return{setFocus:function(a){for(var b in a.model)if(angular.isObject(a.model[b])&&angular.isDefined(a.model[b].focus)){var c=a.validation.errors[b];if(angular.isObject(c)&&c.length)return void(a.model[b].focus=!0)}for(var b in a.model)if(angular.isObject(a.model[b])&&angular.isDefined(a.model[b].focus)){a.model[b].focus=!0;break}},hasFieldErrors:function(a,b){return angular.isArray(a.validation.errors[b])&&a.validation.errors[b].length},clearFieldErrors:function(a,b){a.validation.messages=[],a.validation.errors[b]=[]},setFieldErrors:function(a,b,c){this.hasFieldErrors(a,c)&&this.clearFieldErrors(a,c),a.validation.errors[c]=b.errors},clearErrors:function(a){a.validation.messages=[],a.validation.errors={}},setErrors:function(a,b){angular.isArray(b.messages)&&(a.validation.messages=b.messages),b.success||!angular.isObject(b.errors)?this.clearErrors(a):a.validation.errors=b.errors}}}]),forms.factory("ValidationCtrl",["$timeout","$filter","FormHelper",function(a,b,c){return["$scope","$uibModalInstance","model","validator","submitter",function(b,d,e,f,g){b.model=e,b.validation={messages:[],errors:{}},b.processing=!1,b.resetValidation=function(a){c.clearFieldErrors(b,a)},b.validate=function(d){a(function(){if(!b.processing&&$(".modal").is(":visible")&&f){var a={};for(var e in b.model){var g=b.model[e];angular.isObject(g)&&angular.isDefined(g.value)&&(a[e]=g.value)}a._field=d,f(a).then(function(a){c.setFieldErrors(b,a,d)})}},250)},b.submit=function(){if(b.processing=!0,!g)return c.clearErrors(b),void(b.processing=!1);var a={};for(var d in b.model){var e=b.model[d];angular.isObject(e)&&angular.isDefined(e.value)&&(a[d]=e.value)}g(a).then(function(a){return c.setErrors(b,a),a.success?void(angular.isFunction(b.$close)&&b.$close(a)):void c.setFocus(b)})["finally"](function(){b.processing=!1})}}]}]),forms.factory("LoginForm",["$uibModal","$filter","ValidationCtrl","AuthApi",function(a,b,c,d){return function(){return a.open({controller:c,templateUrl:"modals/login.html",resolve:{model:function(){return{email:{value:"",focus:!0,required:!0},password:{value:"",focus:!1,required:!0}}},validator:function(){return d.validate},submitter:function(){return d.token}}}).result}}]),forms.factory("CreateRoleForm",["$uibModal","$filter","AppControl","ValidationCtrl","RoleApi",function(a,b,c,d,e){return function(b){var f=c.getProfile().locale,g={};return f.available.forEach(function(a){g[a]={title:""}}),a.open({controller:d,templateUrl:"modals/create-role.html",resolve:{model:function(){return{parent_id:{tree:b,value:null,focus:!1,required:!0},handle:{value:"",focus:!0,required:!0},translations:{selected:f.current,value:g,focus:!1,required:!1},locale:f,title_focus:!1}},validator:function(){return e.validate},submitter:function(){return e.create}}}).result}}]),forms.factory("EditRoleForm",["$uibModal","$filter","AppControl","ValidationCtrl","RoleApi",function(a,b,c,d,e){return function(b,f){var g=c.getProfile().locale;return a.open({controller:d,templateUrl:"modals/edit-role.html",resolve:{model:function(){return{id:{value:b.id,focus:!1,required:!1},parent_id:{tree:f,value:b.parent_id,focus:!0,required:!0},handle:{value:b.handle,focus:!1,required:!0},translations:{selected:g.current,value:b.translations,focus:!1,required:!1},locale:g,title_focus:!1,handle_changed:!1,original_handle:b.handle,changeHandle:function(){this.handle_changed=!0,this.handle.focus=!0},cancelHandle:function(){this.handle_changed=!1,this.handle.value=this.original_handle}}},validator:function(){return function(a){return a._id=b.id,e.validate(a)}},submitter:function(){return e.update}}}).result}}]),forms.factory("CreatePermissionForm",["$uibModal","$filter","AppControl","ValidationCtrl","PermissionApi",function(a,b,c,d,e){return function(b){return a.open({controller:d,templateUrl:"modals/create-permission.html",resolve:{model:function(){return{role_id:{tree:b,value:null,focus:!0,required:!0},resource:{value:"",focus:!1,required:!1},action:{value:"",focus:!1,required:!1},locale:c.getProfile().locale}},validator:function(){return e.validate},submitter:function(){return e.create}}}).result}}]),forms.factory("EditPermissionForm",["$uibModal","$filter","AppControl","ValidationCtrl","PermissionApi",function(a,b,c,d,e){return function(b,f){return a.open({controller:d,templateUrl:"modals/edit-permission.html",resolve:{model:function(){return{id:{value:b.id,focus:!1,required:!1},role_id:{tree:f,value:b.role_id,focus:!0,required:!0},resource:{value:b.resource,focus:!1,required:!1},action:{value:b.action,focus:!1,required:!1},locale:c.getProfile().locale}},validator:function(){return function(a){return a._id=role.id,e.validate(a)}},submitter:function(){return e.update}}}).result}}]),forms.factory("CreateUserForm",["$uibModal","$filter","AppControl","ValidationCtrl","UserApi","PasswordGenerator",function(a,b,c,d,e,f){return function(b,g){return a.open({controller:d,templateUrl:"modals/create-user.html",resolve:{model:function(){return{name:{value:"",focus:!0,required:!1},email:{value:"",focus:!1,required:!0},password:{value:"",focus:!1,required:!0},retyped_password:{value:"",focus:!1,required:!0},roles:{tree:g,value:b,focus:!1,required:!1},locale:c.getProfile().locale,updateRoles:function(){function a(c){c.checked&&b.value.push(c.id),$.each(c.roles,function(b,c){a(c)})}var b=this.roles;b.value=[],$.each(b.tree,function(b,c){a(c)})},password_type:"specified",generatePassword:function(){var a=f.get(8);this.password_type="generated",this.password.value=a,this.retyped_password.value=a},specifyPassword:function(){this.password_type="specified",this.password.value="",this.retyped_password.value="",this.password.focus=!0}}},validator:function(){return e.validate},submitter:function(){return e.create}}}).result}}]),forms.factory("EditUserForm",["$uibModal","$filter","AppControl","ValidationCtrl","UserApi","PasswordGenerator",function(a,b,c,d,e,f){return function(b,g){return a.open({controller:d,templateUrl:"modals/edit-user.html",resolve:{model:function(){return{id:{value:b.id,focus:!1,required:!1},name:{value:b.name,focus:!0,required:!1},email:{value:b.email,focus:!1,required:!0},password:{value:"",focus:!1,required:!1},retyped_password:{value:"",focus:!1,required:!1},roles:{tree:g,value:b.roles,focus:!1,required:!1},locale:c.getProfile().locale,updateRoles:function(){function a(c){c.checked&&b.value.push(c.id),$.each(c.roles,function(b,c){a(c)})}var b=this.roles;b.value=[],$.each(b.tree,function(b,c){a(c)})},password_type:"specified",generatePassword:function(){var a=f.get(8);this.password_type="generated",this.password.value=a,this.retyped_password.value=a},specifyPassword:function(){this.password_type="specified",this.password.value="",this.retyped_password.value="",this.password.focus=!0},email_changed:!1,original_email:b.email,changeEmail:function(){this.email_changed=!0,this.email.focus=!0},cancelEmail:function(){this.email_changed=!1,this.email.value=this.original_email}}},validator:function(){return function(a){return a._id=b.id,e.validate(a)}},submitter:function(){return e.update}}}).result}}]),forms.factory("TokenPayloadForm",["$uibModal","$filter","ValidationCtrl",function(a,b,c){return function(b){return a.open({controller:c,templateUrl:"modals/token-payload.html",resolve:{model:function(){return{payload:{value:b,focus:!1,required:!1}}},validator:function(){return null},submitter:function(){return null}}}).result}}]),forms.factory("CreateJobForm",["$uibModal","$filter","ValidationCtrl","JobApi",function(a,b,c,d){return function(b){return a.open({controller:c,templateUrl:"modals/create-job.html",resolve:{model:function(){return{name:{value:"",focus:!0,required:!0},queue:{value:"",focus:!1,required:!1},status:{list:b,value:b[0],focus:!1,required:!0},scheduled_for:{value:"",focus:!1,required:!1},valid_until:{value:"",focus:!1,required:!1},input_data:{value:"",focus:!1,required:!1}}},validator:function(){return function(a){return a.scheduled_for.trim().length&&(a.scheduled_for=moment(a.scheduled_for).unix()),a.valid_until.trim().length&&(a.valid_until=moment(a.valid_until).unix()),d.validate(a)}},submitter:function(){return function(a){return a.scheduled_for.trim().length&&(a.scheduled_for=moment(a.scheduled_for.trim()).unix()),a.valid_until.trim().length&&(a.valid_until=moment(a.valid_until.trim()).unix()),d.create(a)}}}}).result}}]),forms.factory("EditJobForm",["$uibModal","$filter","ValidationCtrl","JobApi",function(a,b,c,d){return function(e,f){return a.open({controller:c,templateUrl:"modals/edit-job.html",resolve:{model:function(){return{id:{value:e.id,focus:!1,required:!1},name:{value:e.name,focus:!0,required:!0},queue:{value:e.queue,focus:!1,required:!1},status:{list:f,value:e.status,focus:!1,required:!0},scheduled_for:{value:moment.unix(e.scheduled_for).format(b("glMessage")("DT_DATE_TIME_FORMAT")),focus:!1,required:!1},valid_until:{value:moment.unix(e.valid_until).format(b("glMessage")("DT_DATE_TIME_FORMAT")),focus:!1,required:!1},input_data:{value:JSON.stringify(e.input_data,void 0,4),focus:!1,required:!1}}},validator:function(){return function(a){return a._id=e.id,a.scheduled_for.trim().length&&(a.scheduled_for=moment(a.scheduled_for).unix()),a.valid_until.trim().length&&(a.valid_until=moment(a.valid_until).unix()),d.validate(a)}},submitter:function(){return function(a){return a.scheduled_for.trim().length&&(a.scheduled_for=moment(a.scheduled_for.trim()).unix()),a.valid_until.trim().length&&(a.valid_until=moment(a.valid_until.trim()).unix()),d.update(a)}}}}).result}}]),forms.factory("JobOutputForm",["$uibModal","$filter","ValidationCtrl",function(a,b,c){return function(b){return a.open({controller:c,templateUrl:"modals/job-output.html",resolve:{model:function(){return{output:{value:b,focus:!1,required:!1}}},validator:function(){return null},submitter:function(){return null}}}).result}}]);var services=angular.module("services",["ngCookies","ui.router","ui.bootstrap","globalizeWrapper","api","forms"]);services.factory("AppControl",["$window","$rootScope","$state","$stateParams","$timeout","$http","$cookies","globalizeWrapper","SocketServer","ProfileApi",function(a,b,c,d,e,f,g,h,i,j){var k=null,l=null,m="Token-"+a.config.project,n={locale:{current:null,"default":null,available:[]},authenticated:!1,name:"Anonymous",email:null,roles:[]},o=!1,p=null;return b.$on("GlobalizeLocaleChanged",function(){if(n.locale.current=h.getLocale(),o)return c.go(c.current.name,d,{reload:!0});o=!0,b.$broadcast("AppInitialized");var a=null;if(null===p)c.current.name.length&&(a=function(){c.go(c.current.name,d,{reload:!0})});else{var f=p;p=null,a=function(){c.go(f.name,f.params,{reload:!0})}}null!==a&&e(a)}),b.$on("$stateChangeStart",function(a,b,c){o||(p={name:b.name,params:c},a.preventDefault())}),{isError:function(){return null!==k},setError:function(a){k=a,k?($("#view-wrapper").addClass("forced-hide"),$("#error-wrapper").removeClass("forced-hide")):($("#error-wrapper").addClass("forced-hide"),$("#view-wrapper").removeClass("forced-hide"))},getError:function(){return k},hasToken:function(){return null!==l},getToken:function(){return l},setToken:function(b){l=b,localStorage.setItem(m,l);var c=i.getSocket();c.emit&&c.emit("token",l),f.defaults.headers.common.Authorization="Bearer "+l,$.ajaxSetup({headers:{Authorization:"Bearer "+l},error:function(b){401==b.status&&(localStorage.removeItem(m),a.location.reload())}})},removeToken:function(){l=null,localStorage.removeItem(m),f.defaults.headers.common.Authorization=void 0,$.ajaxSetup({headers:{Authorization:void 0},error:void 0})},isAllowed:function(a){var b=c.get(a);if(!b)return!1;if(angular.isUndefined(b.roles))return!0;var d=!1;return $.each(this.getProfile().roles,function(a,c){-1!==b.roles.indexOf(c)&&(d=!0)}),d},aclCheckCurrentState:function(){var a=c.current.name;return this.isAllowed(a)?("ACL"==this.getError()&&this.setError(null),!0):(this.setError("ACL"),!1)},getProfile:function(){return n},setProfile:function(a){n=a},loadProfile:function(){var b=g.get("locale");"undefined"==typeof b?f.defaults.headers.common["Accept-Language"]=void 0:f.defaults.headers.common["Accept-Language"]=b.replace("_","-");var e=this;j.read().then(function(f){if(n=f,!n.authenticated&&e.hasToken())return e.removeToken(),a.location.reload();if(o)h.getLocale()!=n.locale.current?h.setLocale(n.locale.current):c.current.name.length&&c.go(c.current.name,d,{reload:!0});else{-1==f.locale.available.indexOf(b)&&g.remove("locale");var i=[f.locale.current.substr(0,2)];f.locale.available.forEach(function(a){var b=a.substr(0,2);-1==i.indexOf(b)&&i.push(b)}),h.loadLocales(i)}})},init:function(){if("undefined"==typeof a.config)return void this.setError("CONFIG");var b=localStorage.getItem(m);null!==b&&this.setToken(b),this.loadProfile()}}}]),services.factory("SocketServer",["$rootScope","$filter",function(a,b){function c(){g=!0,a.$$phase||a.$digest(),a.appControl.hasToken()&&f.emit("token",a.appControl.getToken())}function d(){g=!1,a.$$phase||a.$digest()}function e(a){new PNotify({icon:a.icon&&b("glMessage")(a.icon,a.variables),title:a.title&&b("glMessage")(a.title,a.variables),text:b("glMessage")(a.text,a.variables),mouse_reset:!1})}var f=null,g=!1;return f=io.connect(),f.on("connect",c),f.on("disconnect",d),f.on("notification",e),{getConnected:function(){return g},getSocket:function(){return f}}}]),services.factory("PasswordGenerator",[function(){return{get:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}}}]);var module=angular.module("state.index",[]);module.controller("IndexCtrl",["$scope",function(a){!a.appControl.aclCheckCurrentState()}]);var module=angular.module("state.job-list",[]);module.controller("JobListCtrl",["$scope","$window","$filter","$q","dynamicTable","JobApi","CreateJobForm","EditJobForm","JobOutputForm","InfoDialog",function(a,b,c,d,e,f,g,h,i,j){a.appControl.aclCheckCurrentState()&&(a.hasSelection=!1,a.hasSingleSelection=!1,a.tableCtrl=e({url:b.config.apiUrl+"/job/table",row_id_column:"id",sort_column:"id",mapper:function(a){if(null!=a.created_at){var b=moment.unix(a.created_at).local();a.created_at=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}if(null!=a.scheduled_for){var b=moment.unix(a.scheduled_for).local();a.scheduled_for=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}if(null!=a.valid_until){var b=moment.unix(a.valid_until).local();a.valid_until=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}return a}}),a.createJob=function(){f.statuses().then(function(b){g(b).then(function(){a.tableCtrl.plugin.refresh()})})},a.editJob=function(){var b=a.tableCtrl.plugin.getSelected();d.all([f.read({id:b[0]}),f.statuses()]).then(function(b){var c=b[0],d=b[1];h(c,d).then(function(){a.tableCtrl.plugin.refresh()})})},a.viewOutput=function(){var b=a.tableCtrl.plugin.getSelected();f.read({id:b[0]}).then(function(a){i(JSON.stringify(a.output_data,void 0,4))})},a.deleteJob=function(){var b=a.tableCtrl.plugin.getSelected();j({title:"JOB_CONFIRM_DELETE_TITLE",text:"JOB_CONFIRM_DELETE_TEXT",yes:"JOB_CONFIRM_DELETE_BUTTON"}).result.then(function(){var c=[];"all"===b?c.push(f["delete"]()):$.each(b,function(a,b){c.push(f["delete"]({id:b}))}),d.all(c).then(function(b){a.tableCtrl.plugin.refresh();var c=null;b.some(function(a){return 0==a.success?(c=a.errors.join("<br>"),!0):!1}),c&&j({title:"ERROR_OPERATION_FAILED",text:c})})})},a.$watch("tableCtrl.event",function(){if(a.tableCtrl.event){var c=a.tableCtrl.event;if(a.tableCtrl.event=null,"http-error"==c)return void(401==a.tableCtrl.statusCode&&b.location.reload());var d=a.tableCtrl.plugin.getSelected();a.hasSelection="all"==d||d.length,a.hasSingleSelection="all"!=d&&1==d.length}}))}]);var module=angular.module("state.layout",[]);module.controller("LayoutCtrl",["$scope","$state","$stateParams","$cookies","$window","globalizeWrapper","LoginForm",function(a,b,c,d,e,f,g){a.locale=a.appControl.getProfile().locale,a.setLocale=function(a){d.put("locale",a,{path:"/",expires:moment().add(1,"year").toDate()}),f.setLocale(a)},a.login=function(){g().then(function(b){a.appControl.setToken(b.token),a.appControl.loadProfile()})},a.logout=function(){a.appControl.removeToken(),e.location.reload()}}]);var module=angular.module("state.permission-list",[]);module.controller("PermissionListCtrl",["$scope","$window","$filter","$q","dynamicTable","RoleApi","PermissionApi","CreatePermissionForm","EditPermissionForm","InfoDialog",function(a,b,c,d,e,f,g,h,i,j){a.appControl.aclCheckCurrentState()&&(a.hasSelection=!1,a.hasSingleSelection=!1,a.tableCtrl=e({url:b.config.apiUrl+"/permission/table",row_id_column:"id",sort_column:"id",mapper:function(a){return a}}),a.createPermission=function(){f.list({view:"tree"}).then(function(b){b.length&&(b[0].focus=!0),h(b).then(function(){a.tableCtrl.plugin.refresh()})})},a.editPermission=function(){var b=a.tableCtrl.plugin.getSelected();d.all([g.read({id:b[0]}),f.list({view:"tree"})]).then(function(b){var c=b[0],d=b[1];d.length&&(d[0].focus=!0),i(c,d).then(function(){a.tableCtrl.plugin.refresh()})})},a.deletePermission=function(){var b=a.tableCtrl.plugin.getSelected();j({title:"PERMISSION_CONFIRM_DELETE_TITLE",text:"PERMISSION_CONFIRM_DELETE_TEXT",yes:"PERMISSION_CONFIRM_DELETE_BUTTON"}).result.then(function(){var c=[];"all"===b?c.push(g["delete"]()):$.each(b,function(a,b){c.push(g["delete"]({id:b}))}),d.all(c).then(function(b){a.tableCtrl.plugin.refresh();var c=null;b.some(function(a){return 0==a.success?(c=a.errors.join("<br>"),!0):!1}),c&&j({title:"ERROR_OPERATION_FAILED",text:c})})})},a.$watch("tableCtrl.event",function(){if(a.tableCtrl.event){var c=a.tableCtrl.event;if(a.tableCtrl.event=null,"http-error"==c)return void(401==a.tableCtrl.statusCode&&b.location.reload());var d=a.tableCtrl.plugin.getSelected();a.hasSelection="all"==d||d.length,a.hasSingleSelection="all"!=d&&1==d.length}}))}]);var module=angular.module("state.profile",[]);module.controller("ProfileCtrl",["$scope","$timeout","$filter","FormHelper","ProfileApi",function(a,b,c,d,e){return a.appControl.getProfile().authenticated?(a.model={name:{value:"",focus:!1,required:!1},new_password:{value:"",focus:!1,required:!1},retyped_password:{value:"",focus:!1,required:!1}},a.validation={messages:[],errors:{}},a.loaded=!1,a.processing=!1,e.read().then(function(b){a.model.name.value=b.name,a.loaded=!0,d.setFocus(a)}),a.resetValidation=function(b){d.clearFieldErrors(a,b)},a.validate=function(c){b(function(){a.processing||e.validate({_field:c,name:a.model.name.value,new_password:a.model.new_password.value,retyped_password:a.model.retyped_password.value}).then(function(b){d.setFieldErrors(a,b,c)})},250)},void(a.submit=function(){a.processing=!0,e.update({name:a.model.name.value,new_password:a.model.new_password.value,retyped_password:a.model.retyped_password.value}).then(function(b){if(d.setErrors(a,b),d.setFocus(a),b.success){a.validation.messages=[c("glMessage")("CHANGES_SAVED_LABEL")];var e=a.appControl.getProfile();e.name=a.model.name.value,a.appControl.setProfile(e)}})["finally"](function(){a.processing=!1})})):void a.$state.go("layout.index")}]);var module=angular.module("state.role-list",[]);module.controller("RoleListCtrl",["$scope","$window","$filter","$q","globalizeWrapper","dynamicTable","RoleApi","CreateRoleForm","EditRoleForm","InfoDialog",function(a,b,c,d,e,f,g,h,i,j){a.appControl.aclCheckCurrentState()&&(a.hasSelection=!1,a.hasSingleSelection=!1,a.tableCtrl=f({url:b.config.apiUrl+"/role/table",row_id_column:"id",sort_column:"id",mapper:function(a){return a}}),a.createRole=function(){g.list({view:"tree"}).then(function(b){var d={};d[a.appControl.getProfile().locale.current]={title:c("glMessage")("TOP_ROLE_LABEL")},b.unshift({id:null,handle:"null",roles:[],translations:d,focus:!0}),h(b).then(function(){a.tableCtrl.plugin.refresh()})})},a.editRole=function(){var b=a.tableCtrl.plugin.getSelected();d.all([g.read({id:b[0]}),g.list({view:"tree"})]).then(function(b){function d(a){$.each(a,function(a,b){b.id==e.id&&(b.disabled=!0),d(b.roles)})}var e=b[0],f=b[1],g={};g[a.appControl.getProfile().locale.current]={title:c("glMessage")("TOP_ROLE_LABEL")},f.unshift({id:null,handle:"null",roles:[],translations:g,focus:!0}),d(f),i(e,f).then(function(){a.tableCtrl.plugin.refresh()})})},a.deleteRole=function(){var b=a.tableCtrl.plugin.getSelected();j({title:"ROLE_CONFIRM_DELETE_TITLE",text:"ROLE_CONFIRM_DELETE_TEXT",yes:"ROLE_CONFIRM_DELETE_BUTTON"}).result.then(function(){var c=[];"all"===b?c.push(g["delete"]()):$.each(b,function(a,b){c.push(g["delete"]({id:b}))}),d.all(c).then(function(b){a.tableCtrl.plugin.refresh();var c=null;b.some(function(a){return 0==a.success?(c=a.errors.join("<br>"),!0):!1}),c&&j({title:"ERROR_OPERATION_FAILED",text:c})})})},a.$watch("tableCtrl.event",function(){if(a.tableCtrl.event){var c=a.tableCtrl.event;if(a.tableCtrl.event=null,"http-error"==c)return void(401==a.tableCtrl.statusCode&&b.location.reload());var d=a.tableCtrl.plugin.getSelected();a.hasSelection="all"==d||d.length,a.hasSingleSelection="all"!=d&&1==d.length}}))}]);var module=angular.module("state.send-notification",[]);module.controller("SendNotificationCtrl",["$scope","$filter","globalizeWrapper","NotificationApi","UserApi","RoleApi","InfoDialog",function(a,b,c,d,e,f,g){a.appControl.aclCheckCurrentState()&&(a.recipientType="all",a.recipientRole=null,a.recipientUser=null,a.roleTree=[],f.list().then(function(b){a.roleTree=b,b.length>0&&(a.recipientRole={id:b[0].id})}),a.scheduledFor="now",a.scheduledTime=moment().format(b("glMessage")("DT_DATE_TIME_FORMAT")),a.currentLocale=a.appControl.getProfile().locale.current,a.availableLocales=a.appControl.getProfile().locale.available,a.selectedLocale=a.availableLocales[0],a.premadeSelection="custom",
a.modelCustom={title:"Notification",icon:"glyphicon glyphicon-envelope",text:"Sample text"},a.focusCustom={title:!0,icon:!1,text:!1},a.modelShutdown={minutes:"3"},a.focusShutdown={minutes:!0},a.preview={title:"",text:""},a.sendButtonActive=!1,a.updatePreview=function(){var b=c.getGlobalize(a.selectedLocale),d=!1;switch(a.recipientType){case"all":d=!0;break;case"role":d=angular.isObject(a.recipientRole)&&angular.isDefined(a.recipientRole.id);break;case"user":d=angular.isObject(a.recipientUser)&&angular.isDefined(a.recipientUser.id)}var e=!1;switch(a.premadeSelection){case"custom":a.preview.title=a.modelCustom.title,a.preview.icon=a.modelCustom.icon,a.preview.text=a.modelCustom.text,e=a.modelCustom.text.length>0;break;case"shutdown":var f={minutes:a.modelShutdown.minutes};a.preview.title=b.formatMessage("NOTIFICATION_SHUTDOWN_TITLE",f),a.preview.icon=b.formatMessage("NOTIFICATION_SHUTDOWN_ICON",f),a.preview.text=b.formatMessage("NOTIFICATION_SHUTDOWN_TEXT",f),e=a.modelShutdown.minutes.length>0}a.sendButtonActive=d&&e},a.selectPremade=function(b){switch(a.premadeSelection=b,b){case"custom":a.focusCustom.title=!0;break;case"shutdown":a.focusShutdown.minutes=!0}a.updatePreview()},a.sendNotification=function(){a.sendButtonActive=!1;var b={};switch(a.scheduledFor){case"now":b.scheduled_for=null;break;case"time":b.scheduled_for=moment(a.scheduledTime).unix()}switch(a.premadeSelection){case"custom":b.text=a.modelCustom.text,b.title=a.modelCustom.title,b.icon=a.modelCustom.icon,b.variables={};break;case"shutdown":b.text="NOTIFICATION_SHUTDOWN_TEXT",b.title="NOTIFICATION_SHUTDOWN_TITLE",b.icon="NOTIFICATION_SHUTDOWN_ICON",b.variables={minutes:a.modelShutdown.minutes}}switch(a.recipientType){case"role":b.role_id=a.recipientRole.id;break;case"user":b.user_id=a.recipientUser.id}d.create(b).then(function(b){b.success||g({title:"NOTIFICATION_ERROR_TITLE",text:"NOTIFICATION_ERROR_TEXT"}),a.sendButtonActive=!0})},a.getEmail=function(a){return e.search({criteria:"email",search:a,limit:8}).then(function(a){return a})},a.$watch("recipientType",function(){a.updatePreview()}),a.$watch("recipientRole.id",function(){a.updatePreview()}),a.$watch("recipientUser.id",function(){a.updatePreview()}),a.selectPremade("custom"))}]);var module=angular.module("state.token-list",[]);module.controller("TokenListCtrl",["$scope","$window","$filter","$q","dynamicTable","UserApi","TokenApi","TokenPayloadForm","InfoDialog",function(a,b,c,d,e,f,g,h,i){if(a.appControl.aclCheckCurrentState()){a.userEmail=null,f.read({id:a.$stateParams.userId}).then(function(b){a.userEmail=b.email});var j="?user_id="+a.$stateParams.userId;a.hasSelection=!1,a.hasSingleSelection=!1,a.tableCtrl=e({url:b.config.apiUrl+"/token/table"+j,row_id_column:"id",sort_column:"id",mapper:function(a){if(null!=a.created_at){var b=moment.unix(a.created_at).local();a.created_at=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}if(null!=a.updated_at){var b=moment.unix(a.updated_at).local();a.updated_at=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}return a}}),a.viewPayload=function(){var b=a.tableCtrl.plugin.getSelected();g.read({id:b[0]}).then(function(a){h(JSON.stringify(a.payload,void 0,4))})},a.deleteToken=function(){var b=a.tableCtrl.plugin.getSelected();i({title:"TOKEN_CONFIRM_DELETE_TITLE",text:"TOKEN_CONFIRM_DELETE_TEXT",yes:"TOKEN_CONFIRM_DELETE_BUTTON"}).result.then(function(){var c=[];"all"===b?c.push(g["delete"]()):$.each(b,function(a,b){c.push(g["delete"]({id:b}))}),d.all(c).then(function(b){a.tableCtrl.plugin.refresh();var c=null;b.some(function(a){return 0==a.success?(c=a.errors.join("<br>"),!0):!1}),c&&i({title:"ERROR_OPERATION_FAILED",text:c})})})},a.$watch("tableCtrl.event",function(){if(a.tableCtrl.event){var c=a.tableCtrl.event;if(a.tableCtrl.event=null,"http-error"==c)return void(401==a.tableCtrl.statusCode&&b.location.reload());var d=a.tableCtrl.plugin.getSelected();a.hasSelection="all"==d||d.length,a.hasSingleSelection="all"!=d&&1==d.length}})}}]);var module=angular.module("state.user-list",[]);module.controller("UserListCtrl",["$scope","$window","$filter","$q","dynamicTable","RoleApi","UserApi","CreateUserForm","EditUserForm","InfoDialog",function(a,b,c,d,e,f,g,h,i,j){a.appControl.aclCheckCurrentState()&&(a.hasSelection=!1,a.hasSingleSelection=!1,a.tableCtrl=e({url:b.config.apiUrl+"/user/table",row_id_column:"id",sort_column:"id",mapper:function(a){if(null!=a.created_at){var b=moment.unix(a.created_at).local();a.created_at=b.format(c("glMessage")("DT_DATE_TIME_FORMAT"))}return a.tokens>0&&(a.tokens='<a href="/#/user/'+a.id+'/token">'+a.tokens+"</a>"),a}}),a.createUser=function(){f.list({view:"tree"}).then(function(b){var c=[];$.each(b,function(a,b){return"member"==b.handle?(b.checked=!0,c.push(b.id),!1):void 0}),b.length>0&&(b[0].focus=!0),h(c,b).then(function(){a.tableCtrl.plugin.refresh()})})},a.editUser=function(){var b=a.tableCtrl.plugin.getSelected();d.all([g.read({id:b[0]}),f.list({view:"tree"})]).then(function(b){function c(a){$.each(a,function(a,b){-1!=$.inArray(b.id,d.roles)&&(b.checked=!0),c(b.roles)})}var d=b[0],e=b[1];c(e),e.length>0&&(e[0].focus=!0),i(d,e).then(function(){a.tableCtrl.plugin.refresh()})})},a.deleteUser=function(){var b=a.tableCtrl.plugin.getSelected();j({title:"USER_CONFIRM_DELETE_TITLE",text:"USER_CONFIRM_DELETE_TEXT",yes:"USER_CONFIRM_DELETE_BUTTON"}).result.then(function(){var c=[];"all"===b?c.push(g["delete"]()):$.each(b,function(a,b){c.push(g["delete"]({id:b}))}),d.all(c).then(function(b){a.tableCtrl.plugin.refresh();var c=null;b.some(function(a){return 0==a.success?(c=a.errors.join("<br>"),!0):!1}),c&&j({title:"ERROR_OPERATION_FAILED",text:c})})})},a.$watch("tableCtrl.event",function(){if(a.tableCtrl.event){var c=a.tableCtrl.event;if(a.tableCtrl.event=null,"http-error"==c)return void(401==a.tableCtrl.statusCode&&b.location.reload());var d=a.tableCtrl.plugin.getSelected();a.hasSelection="all"==d||d.length,a.hasSingleSelection="all"!=d&&1==d.length}}))}]);